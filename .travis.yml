language: python

python:
    - 3.4

sudo: required
dist: trusty

before_install:
    - make deps
    - make images
    - "/sbin/start-stop-daemon --start --quiet --pidfile /tmp/custom_xvfb_99.pid --make-pidfile --background --exec /usr/bin/Xvfb -- :99 -ac -screen 0 1280x1024x16"

install:
    - make install

script:
    - flake8 .
    - python -m tornado.testing discover -s tests -t . -v
    - make db
    - make certs
    - pushd jupyterhub
    - chmod 755 `pwd`/start.sh
    - "`pwd`/start.sh" &
    - popd
    - sleep 3
    - DISPLAY=:99 python -m unittest discover -s selenium_tests -t . -v
    - cat /tmp/firefox.log
    - sphinx-build -W doc/source doc/build/sphinx

after_success:
    - . venv/bin/activate
    - coverage run -m tornado.testing discover
    - pip install codecov
    - codecov
    - bash <(curl -s https://codecov.io/bash)
